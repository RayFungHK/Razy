<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SimplifiedMessage &mdash; Razy Framework</title>
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;450;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="../js/docs.js" defer></script>
</head>
<body>
  <header class="site-header"><button class="menu-toggle">&#9776;</button><a href="../index.html" class="header-logo"><span class="logo-icon">R</span> Razy <span class="header-version">v1.0-beta</span></a><nav class="header-nav"><a href="getting-started.html">Docs</a><a href="api-reference.html">API</a><a href="https://github.com/rayfunghk/razy" target="_blank">GitHub</a><button class="theme-toggle">&#x1F319;</button></nav></header>
  <aside class="sidebar"><div class="sidebar-group start-here"><div class="sidebar-group-title">тн?Start Here</div><a href="quick-start.html" class="sidebar-link">Quick Start (5 min)</a><a href="getting-started.html" class="sidebar-link">Installation</a><a href="standalone.html" class="sidebar-link">Standalone Mode</a><a href="tutorial.html" class="sidebar-link">Tutorial</a><a href="roadmap.html" class="sidebar-link">Learning Roadmap</a><a href="modules.html" class="sidebar-link">Module System</a><a href="routing.html" class="sidebar-link">Routing</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Overview</div><a href="../index.html" class="sidebar-link">Introduction</a><a href="architecture.html" class="sidebar-link">Architecture</a><a href="cli.html" class="sidebar-link">CLI Commands</a></div><div class="sidebar-group"><div class="sidebar-group-title">Module Development</div><a href="module-structure.html" class="sidebar-link">Module Structure</a><a href="controller.html" class="sidebar-link">Controller</a><a href="agent.html" class="sidebar-link">Agent</a><a href="events.html" class="sidebar-link">Event System</a><a href="cross-module-api.html" class="sidebar-link">Cross-Module API</a><a href="plugins.html" class="sidebar-link">Plugin System</a></div><div class="sidebar-group"><div class="sidebar-group-title">Routing &amp; Flow</div><a href="middleware.html" class="sidebar-link">Middleware</a><a href="pipeline.html" class="sidebar-link">Pipeline</a><a href="validation.html" class="sidebar-link">Validation</a><a href="container.html" class="sidebar-link">DI Container</a><a href="env.html" class="sidebar-link">Environment (.env)</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Data &amp; Storage</div><a href="database.html" class="sidebar-link">Database</a><a href="orm.html" class="sidebar-link">ORM</a><a href="collection.html" class="sidebar-link">Collection</a><a href="configuration.html" class="sidebar-link">Configuration</a><a href="cache.html" class="sidebar-link">Cache</a><a href="hashmap.html" class="sidebar-link">HashMap</a><a href="yaml.html" class="sidebar-link">YAML</a><a href="queue.html" class="sidebar-link">Queue</a></div><div class="sidebar-group"><div class="sidebar-group-title">Rendering</div><a href="template.html" class="sidebar-link">Template Engine</a><a href="dom.html" class="sidebar-link">DOM Builder</a><a href="simple-syntax.html" class="sidebar-link">Simple Syntax</a></div><div class="sidebar-group"><div class="sidebar-group-title">IO &amp; Communication</div><a href="httpclient.html" class="sidebar-link">HTTP Client</a><a href="xhr.html" class="sidebar-link">XHR</a><a href="sse.html" class="sidebar-link">SSE</a><a href="websocket.html" class="sidebar-link">WebSocket</a><a href="mailer.html" class="sidebar-link">Mailer</a><a href="simplified-message.html" class="sidebar-link">SimplifiedMessage</a><a href="filereader.html" class="sidebar-link">FileReader</a><a href="ftp-sftp.html" class="sidebar-link">FTP &amp; SFTP</a><a href="notification.html" class="sidebar-link">Notification</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Security</div><a href="crypt.html" class="sidebar-link">Crypt</a><a href="csrf.html" class="sidebar-link">CSRF Protection</a><a href="session.html" class="sidebar-link">Session</a><a href="oauth2.html" class="sidebar-link">OAuth2</a><a href="office365sso.html" class="sidebar-link">Office 365 SSO</a><a href="authenticator.html" class="sidebar-link">Authenticator (TOTP/HOTP)</a><a href="authmanager.html" class="sidebar-link">Auth Manager &amp; Gate</a><a href="ratelimiter.html" class="sidebar-link">Rate Limiter</a></div><div class="sidebar-group"><div class="sidebar-group-title">Observability</div><a href="logging.html" class="sidebar-link">Logging</a><a href="profiler.html" class="sidebar-link">Profiler</a><a href="error-handling.html" class="sidebar-link">Error Handling</a></div><div class="sidebar-group"><div class="sidebar-group-title">Advanced</div><a href="thread.html" class="sidebar-link">Thread &amp; ThreadManager</a><a href="worker-lifecycle.html" class="sidebar-link">Worker Lifecycle</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Deployment</div><a href="sites-configuration.html" class="sidebar-link">Sites Configuration</a><a href="packaging.html" class="sidebar-link">Packaging &amp; Distribution</a><a href="publishing.html" class="sidebar-link">Repository &amp; Publishing</a><a href="caddy-worker.html" class="sidebar-link">Caddy Worker Mode</a></div><div class="sidebar-group"><div class="sidebar-group-title">Reference</div><a href="api-reference.html" class="sidebar-link">API Reference</a><a href="moduleinfo.html" class="sidebar-link">ModuleInfo</a><a href="utilities.html" class="sidebar-link">Utility Functions</a><a href="testing.html" class="sidebar-link">Testing</a></div></aside>
  <div class="sidebar-overlay"></div>

  <main class="main-content">
    <h1>SimplifiedMessage</h1>
    <p><code>SimplifiedMessage</code> implements a STOMP-like text protocol for structured inter-process communication. It provides a lightweight, human-readable wire format for exchanging commands, headers, and body content between processes.</p>

    <h2 id="message-format">Message Format</h2>
    <p>Messages follow a simple text-based wire format with a command line, key-value headers, and an optional body terminated by a null character:</p>
    <pre><code><span class="hl-kw">COMMAND</span>\r\n
<span class="hl-var">key</span><span class="hl-op">:</span><span class="hl-str">value</span>\r\n
<span class="hl-var">key</span><span class="hl-op">:</span><span class="hl-str">value</span>\r\n
\r\n
body content\0\r\n</code></pre>
    <p>The command is always uppercase. Headers are colon-separated key-value pairs. An empty line separates headers from the body. The body ends with a null byte (<code>\0</code>) followed by <code>\r\n</code>.</p>

    <h2 id="constructor">Constructor</h2>
    <pre><code><span class="hl-kw">new</span> <span class="hl-cls">SimplifiedMessage</span>(<span class="hl-kw">string</span> <span class="hl-var">$command</span>)</code></pre>
    <p>Creates a new message with the given command. The command is validated against <code>/[a-z]\w*/i</code> and automatically uppercased. Throws an <code>InvalidArgumentException</code> if the command format is invalid.</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\SimplifiedMessage</span>;

<span class="hl-var">$msg</span> = <span class="hl-kw">new</span> <span class="hl-cls">SimplifiedMessage</span>(<span class="hl-str">'connect'</span>);
<span class="hl-cmt">// Command is stored as 'CONNECT'</span></code></pre>

    <h2 id="static-methods">Static Methods</h2>

    <h3>SimplifiedMessage::fetch(string $message): self</h3>
    <p>Parses a raw message string into a <code>SimplifiedMessage</code> object. Extracts the command, all headers, and the body content from the wire format.</p>
    <pre><code><span class="hl-var">$raw</span> = <span class="hl-str">"CONNECTED\r\nversion:1.2\r\nserver:Razy\r\n\r\nWelcome\0\r\n"</span>;
<span class="hl-var">$msg</span> = <span class="hl-cls">SimplifiedMessage</span>::<span class="hl-fn">fetch</span>(<span class="hl-var">$raw</span>);

<span class="hl-fn">echo</span> <span class="hl-var">$msg</span>-><span class="hl-fn">getCommand</span>();            <span class="hl-cmt">// 'CONNECTED'</span>
<span class="hl-fn">echo</span> <span class="hl-var">$msg</span>-><span class="hl-fn">getHeader</span>(<span class="hl-str">'version'</span>);    <span class="hl-cmt">// '1.2'</span>
<span class="hl-fn">echo</span> <span class="hl-var">$msg</span>-><span class="hl-fn">getBody</span>();               <span class="hl-cmt">// 'Welcome'</span></code></pre>

    <h3>SimplifiedMessage::encode(string $text): string</h3>
    <p>Escapes special characters in header values. Backslashes become <code>\\</code> and colons become <code>\c</code>.</p>
    <pre><code><span class="hl-var">$encoded</span> = <span class="hl-cls">SimplifiedMessage</span>::<span class="hl-fn">encode</span>(<span class="hl-str">'host:port\\path'</span>);
<span class="hl-cmt">// 'host\cport\\path'</span></code></pre>

    <h3>SimplifiedMessage::decode(string $text): string</h3>
    <p>Reverses the encoding, restoring <code>\\</code> to <code>\</code> and <code>\c</code> to <code>:</code>.</p>
    <pre><code><span class="hl-var">$decoded</span> = <span class="hl-cls">SimplifiedMessage</span>::<span class="hl-fn">decode</span>(<span class="hl-str">'host\cport\\\\path'</span>);
<span class="hl-cmt">// 'host:port\path'</span></code></pre>

    <h2 id="instance-methods">Instance Methods</h2>
    <table>
      <thead><tr><th>Method</th><th>Return</th><th>Description</th></tr></thead>
      <tbody>
        <tr><td><code>getCommand()</code></td><td><code>string</code></td><td>Get the command string (always uppercase)</td></tr>
        <tr><td><code>setHeader(string $key, string $value)</code></td><td><code>self</code></td><td>Set a header key-value pair (fluent)</td></tr>
        <tr><td><code>getHeader(string $key)</code></td><td><code>?string</code></td><td>Get a header value by key, or <code>null</code> if not set</td></tr>
        <tr><td><code>setBody(string $value)</code></td><td><code>self</code></td><td>Set the message body content (fluent)</td></tr>
        <tr><td><code>getBody()</code></td><td><code>string</code></td><td>Get the message body content</td></tr>
        <tr><td><code>getMessage()</code></td><td><code>string</code></td><td>Serialize the message to wire format string</td></tr>
      </tbody>
    </table>

    <h2 id="usage-examples">Usage Examples</h2>

    <h3>Creating a Message</h3>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\SimplifiedMessage</span>;

<span class="hl-var">$msg</span> = <span class="hl-kw">new</span> <span class="hl-cls">SimplifiedMessage</span>(<span class="hl-str">'send'</span>);
<span class="hl-var">$msg</span>-><span class="hl-fn">setHeader</span>(<span class="hl-str">'destination'</span>, <span class="hl-str">'/queue/tasks'</span>)
    -><span class="hl-fn">setHeader</span>(<span class="hl-str">'content-type'</span>, <span class="hl-str">'application/json'</span>)
    -><span class="hl-fn">setBody</span>(<span class="hl-str">'{"task": "process", "id": 42}'</span>);

<span class="hl-cmt">// Serialize to wire format</span>
<span class="hl-var">$wire</span> = <span class="hl-var">$msg</span>-><span class="hl-fn">getMessage</span>();
<span class="hl-cmt">// "SEND\r\ndestination:/queue/tasks\r\ncontent-type:application/json\r\n\r\n{\"task\": \"process\", \"id\": 42}\0\r\n"</span></code></pre>

    <h3>Parsing a Received Message</h3>
    <pre><code><span class="hl-cmt">// Received from a socket or SSE stream</span>
<span class="hl-var">$raw</span> = <span class="hl-var">$connection</span>-><span class="hl-fn">read</span>();

<span class="hl-var">$msg</span> = <span class="hl-cls">SimplifiedMessage</span>::<span class="hl-fn">fetch</span>(<span class="hl-var">$raw</span>);

<span class="hl-kw">switch</span> (<span class="hl-var">$msg</span>-><span class="hl-fn">getCommand</span>()) {
    <span class="hl-kw">case</span> <span class="hl-str">'MESSAGE'</span>:
        <span class="hl-var">$dest</span> = <span class="hl-var">$msg</span>-><span class="hl-fn">getHeader</span>(<span class="hl-str">'destination'</span>);
        <span class="hl-var">$body</span> = <span class="hl-var">$msg</span>-><span class="hl-fn">getBody</span>();
        <span class="hl-cmt">// Process the message...</span>
        <span class="hl-kw">break</span>;
    <span class="hl-kw">case</span> <span class="hl-str">'ERROR'</span>:
        <span class="hl-var">$error</span> = <span class="hl-var">$msg</span>-><span class="hl-fn">getBody</span>();
        <span class="hl-cmt">// Handle error...</span>
        <span class="hl-kw">break</span>;
}</code></pre>

    <h3>Encoding/Decoding Values with Special Characters</h3>
    <pre><code><span class="hl-cmt">// Header values containing colons or backslashes must be encoded</span>
<span class="hl-var">$value</span> = <span class="hl-str">'C:\Users\data:config'</span>;
<span class="hl-var">$encoded</span> = <span class="hl-cls">SimplifiedMessage</span>::<span class="hl-fn">encode</span>(<span class="hl-var">$value</span>);
<span class="hl-cmt">// 'C\c\\Users\\data\cconfig'</span>

<span class="hl-var">$msg</span> = <span class="hl-kw">new</span> <span class="hl-cls">SimplifiedMessage</span>(<span class="hl-str">'config'</span>);
<span class="hl-var">$msg</span>-><span class="hl-fn">setHeader</span>(<span class="hl-str">'path'</span>, <span class="hl-var">$encoded</span>);

<span class="hl-cmt">// On the receiving end, decode the header value</span>
<span class="hl-var">$decoded</span> = <span class="hl-cls">SimplifiedMessage</span>::<span class="hl-fn">decode</span>(<span class="hl-var">$msg</span>-><span class="hl-fn">getHeader</span>(<span class="hl-str">'path'</span>));
<span class="hl-cmt">// 'C:\Users\data:config'</span></code></pre>

    <h2 id="use-cases">Use Cases</h2>
    <ul>
      <li><strong>Inter-Process Communication (IPC)</strong> &mdash;Exchange structured messages between PHP processes spawned via <code>ThreadManager</code></li>
      <li><strong>Message Queues</strong> &mdash;Build lightweight task queues with command-based routing and header metadata</li>
      <li><strong>Custom Protocols over SSE</strong> &mdash;Send structured messages through Server-Sent Events streams using <code>getMessage()</code> as the event data</li>
      <li><strong>Socket Communication</strong> &mdash;Use the wire format over TCP or Unix sockets for real-time bidirectional messaging</li>
      <li><strong>Worker Coordination</strong> &mdash;Coordinate background workers with typed commands and metadata headers</li>
    </ul>

    <div class="page-nav">
      <a href="mailer.html"><span class="label">&larr; Previous</span><span class="title">Mailer</span></a>
      <a href="filereader.html" class="next"><span class="label">Next &rarr;</span><span class="title">FileReader</span></a>
    </div>
  </main>
  <footer class="site-footer"><span>Razy Framework v1.0-beta</span><span><a href="https://github.com/rayfunghk/razy" target="_blank">GitHub</a></span></footer>
</body>
</html>
