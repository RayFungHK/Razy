<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Middleware &mdash; Razy Framework</title>
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;450;500;600;700;800&amp;family=JetBrains+Mono:wght@400;500;600&amp;display=swap" rel="stylesheet">
  <script src="../js/docs.js" defer></script>
</head>
<body>
  <header class="site-header"><button class="menu-toggle">&#9776;</button><a href="../index.html" class="header-logo"><span class="logo-icon">R</span> Razy <span class="header-version">v1.0-beta</span></a><nav class="header-nav"><a href="getting-started.html">Docs</a><a href="api-reference.html">API</a><a href="https://github.com/rayfunghk/razy" target="_blank">GitHub</a><button class="theme-toggle">&#x1F319;</button></nav></header>
  <aside class="sidebar"><div class="sidebar-group start-here"><div class="sidebar-group-title">&#x2B50; Start Here</div><a href="quick-start.html" class="sidebar-link">Quick Start (5 min)</a><a href="getting-started.html" class="sidebar-link">Installation</a><a href="standalone.html" class="sidebar-link">Standalone Mode</a><a href="tutorial.html" class="sidebar-link">Tutorial</a><a href="roadmap.html" class="sidebar-link">Learning Roadmap</a><a href="modules.html" class="sidebar-link">Module System</a><a href="routing.html" class="sidebar-link">Routing</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Overview</div><a href="../index.html" class="sidebar-link">Introduction</a><a href="architecture.html" class="sidebar-link">Architecture</a><a href="cli.html" class="sidebar-link">CLI Commands</a></div><div class="sidebar-group"><div class="sidebar-group-title">Module Development</div><a href="module-structure.html" class="sidebar-link">Module Structure</a><a href="controller.html" class="sidebar-link">Controller</a><a href="agent.html" class="sidebar-link">Agent</a><a href="events.html" class="sidebar-link">Event System</a><a href="cross-module-api.html" class="sidebar-link">Cross-Module API</a><a href="plugins.html" class="sidebar-link">Plugin System</a></div><div class="sidebar-group"><div class="sidebar-group-title">Routing &amp; Flow</div><a href="middleware.html" class="sidebar-link">Middleware</a><a href="pipeline.html" class="sidebar-link">Pipeline</a><a href="validation.html" class="sidebar-link">Validation</a><a href="container.html" class="sidebar-link">DI Container</a><a href="env.html" class="sidebar-link">Environment (.env)</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Data &amp; Storage</div><a href="database.html" class="sidebar-link">Database</a><a href="orm.html" class="sidebar-link">ORM</a><a href="collection.html" class="sidebar-link">Collection</a><a href="configuration.html" class="sidebar-link">Configuration</a><a href="cache.html" class="sidebar-link">Cache</a><a href="hashmap.html" class="sidebar-link">HashMap</a><a href="yaml.html" class="sidebar-link">YAML</a><a href="queue.html" class="sidebar-link">Queue</a></div><div class="sidebar-group"><div class="sidebar-group-title">Rendering</div><a href="template.html" class="sidebar-link">Template Engine</a><a href="dom.html" class="sidebar-link">DOM Builder</a><a href="simple-syntax.html" class="sidebar-link">Simple Syntax</a></div><div class="sidebar-group"><div class="sidebar-group-title">IO &amp; Communication</div><a href="httpclient.html" class="sidebar-link">HTTP Client</a><a href="xhr.html" class="sidebar-link">XHR</a><a href="sse.html" class="sidebar-link">SSE</a><a href="websocket.html" class="sidebar-link">WebSocket</a><a href="mailer.html" class="sidebar-link">Mailer</a><a href="simplified-message.html" class="sidebar-link">SimplifiedMessage</a><a href="filereader.html" class="sidebar-link">FileReader</a><a href="ftp-sftp.html" class="sidebar-link">FTP &amp; SFTP</a><a href="notification.html" class="sidebar-link">Notification</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Security</div><a href="crypt.html" class="sidebar-link">Crypt</a><a href="csrf.html" class="sidebar-link">CSRF Protection</a><a href="session.html" class="sidebar-link">Session</a><a href="oauth2.html" class="sidebar-link">OAuth2</a><a href="office365sso.html" class="sidebar-link">Office 365 SSO</a><a href="authenticator.html" class="sidebar-link">Authenticator (TOTP/HOTP)</a><a href="authmanager.html" class="sidebar-link">Auth Manager &amp; Gate</a><a href="ratelimiter.html" class="sidebar-link">Rate Limiter</a></div><div class="sidebar-group"><div class="sidebar-group-title">Observability</div><a href="logging.html" class="sidebar-link">Logging</a><a href="profiler.html" class="sidebar-link">Profiler</a><a href="error-handling.html" class="sidebar-link">Error Handling</a></div><div class="sidebar-group"><div class="sidebar-group-title">Advanced</div><a href="thread.html" class="sidebar-link">Thread &amp; ThreadManager</a><a href="worker-lifecycle.html" class="sidebar-link">Worker Lifecycle</a></div><hr class="sidebar-divider"><div class="sidebar-group"><div class="sidebar-group-title">Deployment</div><a href="sites-configuration.html" class="sidebar-link">Sites Configuration</a><a href="packaging.html" class="sidebar-link">Packaging &amp; Distribution</a><a href="publishing.html" class="sidebar-link">Repository &amp; Publishing</a><a href="caddy-worker.html" class="sidebar-link">Caddy Worker Mode</a></div><div class="sidebar-group"><div class="sidebar-group-title">Reference</div><a href="api-reference.html" class="sidebar-link">API Reference</a><a href="moduleinfo.html" class="sidebar-link">ModuleInfo</a><a href="utilities.html" class="sidebar-link">Utility Functions</a><a href="testing.html" class="sidebar-link">Testing</a></div></aside>
  <div class="sidebar-overlay"></div>

  <main class="main-content">
    <h1>Middleware</h1>
    <p>Razy's middleware system provides an onion-model request/response pipeline. Middleware classes intercept requests before they reach your controller and can modify the response on the way back out.</p>

    <h2>Quick Start</h2>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Distributor\MiddlewareInterface</span>;
<span class="hl-kw">use</span> <span class="hl-cls">Razy\Distributor\MiddlewarePipeline</span>;

<span class="hl-cmt">// Class-based middleware</span>
<span class="hl-kw">class</span> <span class="hl-cls">LogMiddleware</span> <span class="hl-kw">implements</span> <span class="hl-cls">MiddlewareInterface</span>
{
    <span class="hl-kw">public function</span> <span class="hl-fn">handle</span>(<span class="hl-kw">array</span> <span class="hl-var">$context</span>, <span class="hl-cls">\Closure</span> <span class="hl-var">$next</span>): <span class="hl-kw">mixed</span>
    {
        <span class="hl-var">$start</span> = <span class="hl-fn">microtime</span>(<span class="hl-kw">true</span>);
        <span class="hl-var">$result</span> = <span class="hl-var">$next</span>(<span class="hl-var">$context</span>);
        <span class="hl-var">$elapsed</span> = <span class="hl-fn">microtime</span>(<span class="hl-kw">true</span>) - <span class="hl-var">$start</span>;
        <span class="hl-fn">error_log</span>(<span class="hl-str">"Request took {<span class="hl-var">$elapsed</span>}s"</span>);
        <span class="hl-kw">return</span> <span class="hl-var">$result</span>;
    }
}

<span class="hl-cmt">// Build a pipeline</span>
<span class="hl-var">$pipeline</span> = <span class="hl-kw">new</span> <span class="hl-cls">MiddlewarePipeline</span>();
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">LogMiddleware</span>());
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">AuthMiddleware</span>(<span class="hl-var">$auth</span>));

<span class="hl-var">$response</span> = <span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">handle</span>(<span class="hl-var">$context</span>, <span class="hl-kw">function</span> (<span class="hl-kw">array</span> <span class="hl-var">$ctx</span>) {
    <span class="hl-kw">return</span> [<span class="hl-str">'status'</span> =&gt; <span class="hl-num">200</span>, <span class="hl-str">'body'</span> =&gt; <span class="hl-str">'Hello'</span>];
});</code></pre>

    <h2>MiddlewareInterface</h2>
    <p>Every middleware class implements this single-method interface:</p>
    <pre><code><span class="hl-kw">namespace</span> <span class="hl-cls">Razy\Distributor</span>;

<span class="hl-kw">interface</span> <span class="hl-cls">MiddlewareInterface</span>
{
    <span class="hl-kw">public function</span> <span class="hl-fn">handle</span>(<span class="hl-kw">array</span> <span class="hl-var">$context</span>, <span class="hl-cls">\Closure</span> <span class="hl-var">$next</span>): <span class="hl-kw">mixed</span>;
}</code></pre>

    <p>Parameters:</p>
    <ul>
      <li><code>$context</code> &mdash;associative array with request data</li>
      <li><code>$next</code> &mdash;closure that invokes the next middleware (or the final handler)</li>
    </ul>

    <p>The <code>$context</code> array typically contains:</p>
    <table>
      <thead>
        <tr><th>Key</th><th>Type</th><th>Description</th></tr>
      </thead>
      <tbody>
        <tr><td><code>method</code></td><td><code>string</code></td><td>HTTP method (GET, POST, etc.)</td></tr>
        <tr><td><code>route</code></td><td><code>string</code></td><td>Matched route path</td></tr>
        <tr><td><code>headers</code></td><td><code>array</code></td><td>Request headers</td></tr>
        <tr><td><code>body</code></td><td><code>mixed</code></td><td>Request body / parsed data</td></tr>
        <tr><td><code>params</code></td><td><code>array</code></td><td>Route parameters</td></tr>
        <tr><td><code>query</code></td><td><code>array</code></td><td>Query string parameters</td></tr>
      </tbody>
    </table>

    <h2>Class-Based Middleware</h2>
    <pre><code><span class="hl-kw">class</span> <span class="hl-cls">CorsMiddleware</span> <span class="hl-kw">implements</span> <span class="hl-cls">MiddlewareInterface</span>
{
    <span class="hl-kw">public function</span> <span class="hl-fn">handle</span>(<span class="hl-kw">array</span> <span class="hl-var">$context</span>, <span class="hl-cls">\Closure</span> <span class="hl-var">$next</span>): <span class="hl-kw">mixed</span>
    {
        <span class="hl-var">$response</span> = <span class="hl-var">$next</span>(<span class="hl-var">$context</span>);

        <span class="hl-cmt">// Add CORS headers to response</span>
        <span class="hl-kw">if</span> (<span class="hl-fn">is_array</span>(<span class="hl-var">$response</span>)) {
            <span class="hl-var">$response</span>[<span class="hl-str">'headers'</span>] = <span class="hl-fn">array_merge</span>(
                <span class="hl-var">$response</span>[<span class="hl-str">'headers'</span>] ?? [],
                [
                    <span class="hl-str">'Access-Control-Allow-Origin'</span> =&gt; <span class="hl-str">'*'</span>,
                    <span class="hl-str">'Access-Control-Allow-Methods'</span> =&gt; <span class="hl-str">'GET, POST, PUT, DELETE'</span>,
                ]
            );
        }

        <span class="hl-kw">return</span> <span class="hl-var">$response</span>;
    }
}</code></pre>

    <h2>Closure-Based Middleware</h2>
    <p>For simple cases, use a closure directly:</p>
    <pre><code><span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">function</span> (<span class="hl-kw">array</span> <span class="hl-var">$context</span>, <span class="hl-cls">\Closure</span> <span class="hl-var">$next</span>): <span class="hl-kw">mixed</span> {
    <span class="hl-kw">if</span> (!isset(<span class="hl-var">$context</span>[<span class="hl-str">'headers'</span>][<span class="hl-str">'Authorization'</span>])) {
        <span class="hl-kw">return</span> [<span class="hl-str">'status'</span> =&gt; <span class="hl-num">401</span>, <span class="hl-str">'body'</span> =&gt; <span class="hl-str">'Unauthorized'</span>];
    }
    <span class="hl-kw">return</span> <span class="hl-var">$next</span>(<span class="hl-var">$context</span>);
});</code></pre>

    <h2>MiddlewarePipeline</h2>
    <p>The pipeline executes middleware in the order they are added (onion model). Each middleware wraps the next:</p>
    <pre><code>Request &rarr; [Middleware 1] &rarr; [Middleware 2] &rarr; [Middleware 3] &mdash; Handler
Response &rarr; [Middleware 1] &rarr; [Middleware 2] &rarr; [Middleware 3] &mdash; Handler</code></pre>

    <pre><code><span class="hl-var">$pipeline</span> = <span class="hl-kw">new</span> <span class="hl-cls">MiddlewarePipeline</span>();

<span class="hl-cmt">// Add middleware (executed in order)</span>
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">LogMiddleware</span>());
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">AuthMiddleware</span>(<span class="hl-var">$auth</span>));
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">CorsMiddleware</span>());

<span class="hl-cmt">// Execute the pipeline with a final handler</span>
<span class="hl-var">$response</span> = <span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">handle</span>(<span class="hl-var">$context</span>, <span class="hl-kw">function</span> (<span class="hl-kw">array</span> <span class="hl-var">$ctx</span>) {
    <span class="hl-kw">return</span> <span class="hl-cls">MyController</span>::<span class="hl-fn">handleRequest</span>(<span class="hl-var">$ctx</span>);
});</code></pre>

    <h2>MiddlewareGroupRegistry</h2>
    <p>Group middleware under named keys for reuse across routes:</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Distributor\MiddlewareGroupRegistry</span>;

<span class="hl-var">$registry</span> = <span class="hl-kw">new</span> <span class="hl-cls">MiddlewareGroupRegistry</span>();

<span class="hl-cmt">// Define groups</span>
<span class="hl-var">$registry</span>-&gt;<span class="hl-fn">define</span>(<span class="hl-str">'web'</span>, [
    <span class="hl-kw">new</span> <span class="hl-cls">SessionMiddleware</span>(<span class="hl-var">$session</span>),
    <span class="hl-kw">new</span> <span class="hl-cls">CsrfMiddleware</span>(<span class="hl-var">$csrf</span>),
    <span class="hl-kw">new</span> <span class="hl-cls">CorsMiddleware</span>(),
]);

<span class="hl-var">$registry</span>-&gt;<span class="hl-fn">define</span>(<span class="hl-str">'api'</span>, [
    <span class="hl-kw">new</span> <span class="hl-cls">AuthMiddleware</span>(<span class="hl-var">$auth</span>),
    <span class="hl-kw">new</span> <span class="hl-cls">RateLimitMiddleware</span>(<span class="hl-num">100</span>, <span class="hl-num">60</span>),
]);

<span class="hl-cmt">// Resolve a single group</span>
<span class="hl-var">$webMiddleware</span> = <span class="hl-var">$registry</span>-&gt;<span class="hl-fn">resolve</span>(<span class="hl-str">'web'</span>);
<span class="hl-cmt">// [SessionMiddleware, CsrfMiddleware, CorsMiddleware]</span>

<span class="hl-cmt">// Resolve multiple groups into a flat array</span>
<span class="hl-var">$all</span> = <span class="hl-var">$registry</span>-&gt;<span class="hl-fn">resolveMany</span>(<span class="hl-str">'web'</span>, <span class="hl-str">'api'</span>);
<span class="hl-cmt">// [SessionMiddleware, CsrfMiddleware, CorsMiddleware, AuthMiddleware, RateLimitMiddleware]</span></code></pre>

    <h2>Built-in Middleware</h2>

    <h3>AuthMiddleware</h3>
    <p>Validates authentication tokens/sessions:</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Middleware\AuthMiddleware</span>;

<span class="hl-var">$middleware</span> = <span class="hl-kw">new</span> <span class="hl-cls">AuthMiddleware</span>(<span class="hl-var">$authenticator</span>);
<span class="hl-cmt">// Short-circuits with 401 if not authenticated</span></code></pre>

    <h3>AuthorizeMiddleware</h3>
    <p>Checks authorization/permission for a specific ability:</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Middleware\AuthorizeMiddleware</span>;

<span class="hl-var">$middleware</span> = <span class="hl-kw">new</span> <span class="hl-cls">AuthorizeMiddleware</span>(<span class="hl-var">$gate</span>, <span class="hl-str">'edit-post'</span>);
<span class="hl-cmt">// Short-circuits with 403 if not authorized</span></code></pre>

    <h3>SessionMiddleware</h3>
    <p>Starts and saves the session around the request:</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Middleware\SessionMiddleware</span>;

<span class="hl-var">$middleware</span> = <span class="hl-kw">new</span> <span class="hl-cls">SessionMiddleware</span>(<span class="hl-var">$session</span>);
<span class="hl-cmt">// Calls $session-&gt;start() before, $session-&gt;save() after</span></code></pre>

    <h3>CsrfMiddleware</h3>
    <p>Validates CSRF tokens on state-changing requests:</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Middleware\CsrfMiddleware</span>;

<span class="hl-var">$middleware</span> = <span class="hl-kw">new</span> <span class="hl-cls">CsrfMiddleware</span>(<span class="hl-var">$csrfTokenManager</span>);
<span class="hl-cmt">// Skips GET, HEAD, OPTIONS</span>
<span class="hl-cmt">// Checks _token field, X-CSRF-TOKEN header</span>
<span class="hl-cmt">// Returns 419 on mismatch</span></code></pre>

    <h3>RateLimitMiddleware</h3>
    <p>Limits request frequency per client:</p>
    <pre><code><span class="hl-kw">use</span> <span class="hl-cls">Razy\Middleware\RateLimitMiddleware</span>;

<span class="hl-var">$middleware</span> = <span class="hl-kw">new</span> <span class="hl-cls">RateLimitMiddleware</span>(
    <span class="hl-fn">maxRequests</span>: <span class="hl-num">100</span>,
    <span class="hl-fn">windowSeconds</span>: <span class="hl-num">60</span>,
);
<span class="hl-cmt">// Adds X-RateLimit-Limit, X-RateLimit-Remaining headers</span>
<span class="hl-cmt">// Returns 429 Too Many Requests when exceeded</span></code></pre>

    <h2>Combining Middleware</h2>
    <pre><code><span class="hl-var">$pipeline</span> = <span class="hl-kw">new</span> <span class="hl-cls">MiddlewarePipeline</span>();

<span class="hl-cmt">// Apply group</span>
<span class="hl-var">$webMiddleware</span> = <span class="hl-var">$registry</span>-&gt;<span class="hl-fn">resolve</span>(<span class="hl-str">'web'</span>);
<span class="hl-kw">foreach</span> (<span class="hl-var">$webMiddleware</span> <span class="hl-kw">as</span> <span class="hl-var">$mw</span>) {
    <span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-var">$mw</span>);
}

<span class="hl-cmt">// Add route-specific middleware</span>
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">AuthorizeMiddleware</span>(<span class="hl-var">$gate</span>, <span class="hl-str">'admin'</span>));

<span class="hl-var">$response</span> = <span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">handle</span>(<span class="hl-var">$context</span>, <span class="hl-var">$handler</span>);</code></pre>

    <h2>Conditional Middleware</h2>
    <pre><code><span class="hl-kw">class</span> <span class="hl-cls">ConditionalMiddleware</span> <span class="hl-kw">implements</span> <span class="hl-cls">MiddlewareInterface</span>
{
    <span class="hl-kw">public function</span> <span class="hl-fn">__construct</span>(
        <span class="hl-kw">private</span> <span class="hl-cls">MiddlewareInterface</span> <span class="hl-var">$inner</span>,
        <span class="hl-kw">private</span> <span class="hl-cls">\Closure</span> <span class="hl-var">$condition</span>,
    ) {}

    <span class="hl-kw">public function</span> <span class="hl-fn">handle</span>(<span class="hl-kw">array</span> <span class="hl-var">$context</span>, <span class="hl-cls">\Closure</span> <span class="hl-var">$next</span>): <span class="hl-kw">mixed</span>
    {
        <span class="hl-kw">if</span> ((<span class="hl-var">$this</span>-&gt;<span class="hl-var">condition</span>)(<span class="hl-var">$context</span>)) {
            <span class="hl-kw">return</span> <span class="hl-var">$this</span>-&gt;<span class="hl-var">inner</span>-&gt;<span class="hl-fn">handle</span>(<span class="hl-var">$context</span>, <span class="hl-var">$next</span>);
        }
        <span class="hl-kw">return</span> <span class="hl-var">$next</span>(<span class="hl-var">$context</span>);
    }
}

<span class="hl-cmt">// Only apply rate limiting to API routes</span>
<span class="hl-var">$pipeline</span>-&gt;<span class="hl-fn">pipe</span>(<span class="hl-kw">new</span> <span class="hl-cls">ConditionalMiddleware</span>(
    <span class="hl-kw">new</span> <span class="hl-cls">RateLimitMiddleware</span>(<span class="hl-num">100</span>, <span class="hl-num">60</span>),
    <span class="hl-fn">fn</span>(<span class="hl-kw">array</span> <span class="hl-var">$ctx</span>) =&gt; <span class="hl-fn">str_starts_with</span>(<span class="hl-var">$ctx</span>[<span class="hl-str">'route'</span>], <span class="hl-str">'/api/'</span>),
));</code></pre>

    <h2>API Reference</h2>

    <h3>MiddlewareInterface</h3>
    <table>
      <thead>
        <tr><th>Method</th><th>Signature</th><th>Returns</th></tr>
      </thead>
      <tbody>
        <tr><td><code>handle</code></td><td><code>(array $context, Closure $next): mixed</code></td><td>Response</td></tr>
      </tbody>
    </table>

    <h3>MiddlewarePipeline</h3>
    <table>
      <thead>
        <tr><th>Method</th><th>Signature</th><th>Returns</th></tr>
      </thead>
      <tbody>
        <tr><td><code>pipe</code></td><td><code>(MiddlewareInterface|Closure $middleware): static</code></td><td>Self</td></tr>
        <tr><td><code>handle</code></td><td><code>(array $context, Closure $handler): mixed</code></td><td>Response</td></tr>
      </tbody>
    </table>

    <h3>MiddlewareGroupRegistry</h3>
    <table>
      <thead>
        <tr><th>Method</th><th>Signature</th><th>Returns</th></tr>
      </thead>
      <tbody>
        <tr><td><code>define</code></td><td><code>(string $name, array $middleware): void</code></td><td></td></tr>
        <tr><td><code>resolve</code></td><td><code>(string $name): array</code></td><td>Middleware list</td></tr>
        <tr><td><code>resolveMany</code></td><td><code>(string ...$names): array</code></td><td>Flat merged list</td></tr>
      </tbody>
    </table>

    <h3>Built-in Middleware</h3>
    <table>
      <thead>
        <tr><th>Class</th><th>Constructor</th><th>Rejects With</th></tr>
      </thead>
      <tbody>
        <tr><td><code>AuthMiddleware</code></td><td><code>($authenticator)</code></td><td>401 Unauthorized</td></tr>
        <tr><td><code>AuthorizeMiddleware</code></td><td><code>($gate, string $ability)</code></td><td>403 Forbidden</td></tr>
        <tr><td><code>SessionMiddleware</code></td><td><code>($session)</code></td><td>&mdash; (passthrough)</td></tr>
        <tr><td><code>CsrfMiddleware</code></td><td><code>($tokenManager)</code></td><td>419 Token Mismatch</td></tr>
        <tr><td><code>RateLimitMiddleware</code></td><td><code>(int $max, int $window)</code></td><td>429 Too Many Requests</td></tr>
      </tbody>
    </table>

    <div class="page-nav">
      <a href="cross-module-api.html"><span class="label">&larr; Previous</span><span class="title">Cross-Module API</span></a>
      <a href="pipeline.html" class="next"><span class="label">Next &rarr;</span><span class="title">Pipeline</span></a>
    </div>
  </main>
  <footer class="site-footer"><span>Razy Framework v1.0-beta</span><span><a href="https://github.com/rayfunghk/razy" target="_blank">GitHub</a></span></footer>
</body>
</html>