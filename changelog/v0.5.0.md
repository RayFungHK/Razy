# Razy v0.5.0

**Builds 220–238** | October – December 2024

The **v0.5 milestone** — a ground-up simplification of the application lifecycle, introduction of the `FlowManager` system (later renamed to `Pipeline` in v0.5.4), `WRAPPER` template blocks, PSR-compliant autoloading, and dependency-ordered module loading.

> Build 220 was originally tagged as v0.4.5 but represents the v0.5.0 transition commit (git tag `v0.5.0-220`).

---

## Build 220 (2024-10-27) — The v0.5 Transition

### Breaking Changes

- **Application lifecycle simplified** to: `__onInit()` → `__onLoad()` → `__onRequire()` → Await Callbacks Resolve → `__onReady()` → `__onScriptLoaded()` / `__onRouted()` → `__onEntry()` → `__onDispose()`
- Application now runs as an instance — creating an `Application` object no longer automatically matches the domain
- Razy.phar `validate` command renamed to `compose`
- Renamed `Controller::load()` → `Controller::loadTemplate()`
- Renamed `Controller::getBaseURL()` → `Controller::getModuleURL()`
- Renamed `Controller::getModulePath()` → `Controller::getModuleSystemPath()`
- In `package.php`: `api` → `api_name`, `autoload_shared` → `global_module`, `greedy` → `autoload`
- Event handling syntax changed to `$agent->listen('module_namespace:event_name', ...$args)` to prevent name conflicts
- Route paths now support `r:` prefix for same-module redirection
- All Closure parameters changed to `callable` for wider support
- Anonymous Class plugin filenames must start with uppercase; Closure plugin filenames start with lowercase

### Additions

- Added `Error::DebugConsoleWrite()` to display custom debug messages on the error page
- Added `Template::ParseContent()` to parse content using the template engine with given parameter values
- Added `Statement::collect()` and `Statement::getCollection()` to extract data as arrays from `Statement::lazyGroup()` results
- Added `Controller::addRoute()` and `Controller::addLazyRoute()` support for passing `Route` objects

### Changes

- Enhanced library autoloading to meet PSR requirements
- Module loading order now based on dependencies — prevents modules from being unable to access required modules during loading stage
- Distributor code standardized: supports `-` in code; folder name must match distributor code
- Enhanced `PackageManager` to assign notification callback in constructor (instead of static function)
- Action plugin `regroup` now supports key-value pair regrouping
- Application validates multisite config and `.htaccess` during shutdown to detect malicious modifications

### Fixes

- Fixed `Action::submit()` assigning incorrect column to `ON DUPLICATE UPDATE` syntax
- Fixed API emitter passing incorrect `ModuleInfo` to `__onAPICall()`
- Fixed Template engine not correctly displaying `0` value as text
- Fixed `Template\Source::link()` error indicating `$template` is read-only
- Fixed `TableJoinSyntax` syntax warning
- Fixed `WhereSyntax` operator `|=` causing error with empty array (now converts to `NULL`)
- Fixed `WhereSyntax` operator `@=` not passing correct data type for JSON key search

---

## Build 221 (2024-10-28)

- Added new Template Block type `WRAPPER` — links with `BLOCK` elements sharing its name nested beneath it; only parsed when an entity block is created; `newBlock()` on a `WRAPPER` forwards to its child `BLOCK`
- Added `base_url` to distributor route information for the full URL of the matched route

## Build 222 (2024-11-04)

### Additions

- Introduced `FlowManager` and `Flow` system to replace `Action` and `Validation` classes — processes and resolves chainable operations for more readable code (renamed to `Pipeline` and `Action` in v0.5.4)
- Added `PluginTrait` for classes that provide a plugin system
- New logical `Max` statement builder — improved performance for "greatest N per group" operations
- New `WRAPPER` Template block type (refined) — `BLOCK` with the same name must be included; generates content wrapping the `BLOCK`

### Changes

- Anonymous Class plugins must now be enclosed within a Closure for reliable structure
- `Statement::getValueAsStatement()` now converts arrays to JSON strings

### Fixes

- Fixed missing files not committed
- Fixed error backtrace breaking when message includes HTML
- Fixed `Template::Entity` error: "Cannot call method_exists() on array"
- Fixed `Statement::getValueAsStatement()` generating no output for boolean values
- Fixed `Application` assigning incorrect value to distributor path

## Build 223 (2024-11-11)

- Fixed `xcopy` functionality in Windows environments
- Added alter function to `Table` class (temporary implementation)

## Build 224 (2024-11-15)

- Added new route options: `r@:path` for redirecting to a path with the site root, and `r:path` for redirecting with the module code prefix
- Fixed column types `full_text` and `long_text` causing errors due to default value assignment; now set to nullable

## Build 226 (2024-11-18)

### Additions

- Flow now supports identifiers using `->next('FlowType:Identifier')` — stores data by identifier after `FormWorker` processing; retrieve with `FormWorker::getStorage('ValidateName', 'Identifier')`
- Flow identifier support for `->getParent('FlowType:Identifier')` or `->getParent(':Identifier')` to match by identifier name
- Added new Flow type `Fetch` — retrieves records from the database; rejects with error code if not found

### Fixes

- Fixed incorrect path of rewrite file in protection data
- Fixed `Distributor::initialize()` triggering `__onInit()` without `$initialOnly` parameter
- Fixed Flow plugin `Validate` not halting when a Flow in the chain is rejected

## Build 227 (2024-11-18)

### Additions

- Added Flow's `Validation::getStorage()`, `Validation::setStorage()`, `Validation::getValue()`, and `Validation::setValue()` for data and storage management
- Flow's `FormWorker` now supports array of toggle columns with specified values (array values converted using `in` syntax)

### Fixes

- Fixed PSR-0 autoload library not working
- Fixed incorrect `Block` path name format under root
- Fixed Flow `FormWorker::getStorage()` returning `null` instead of root storage when identifier storage doesn't exist
- Fixed Flow `FormWorker` overriding preset values during processing stage

## Build 228 (2024-11-21)

- Fixed Flow's `Password` component no longer overrides the password when not provided in edit mode
- Fixed Flow's `FormWorker` storage working correctly with identifiers

## Build 229 (2024-11-22)

- Fixed Flow's `FormWorker::getToggleColumn` throwing error when value is an array
- Fixed Flow's `Unique` throwing error when toggle column is an array
- Fixed terminal command `set` displaying an undefined `i` warning

## Build 230 (2024-11-26)

- Fixed `Statement::where()` unable to parse non-column expression syntax
- Added parameter to `SimpleSyntax::ParseSyntax()` to disable delimiter capture

## Build 231 (2024-11-26 / 2024-11-30)

- Enhanced `.htaccess` rewrite to prevent unnecessary loading through Razy route and random paths, reducing access time
- Fixed multiple sites with same distributor unable to write correct rewrite rule
- Fixed Flow's `Fetch` incorrectly converting values to integers in certain cases
- Added `onBeforeProcess` event to FlowManager
- Fixed rewrite rules overriding request paths for existing files
- Fixed parameter parsing in `Statement` order syntax
- Fixed error when `WhereSyntax` named parameters contain non-scalar values

## Build 232 (2024-12-17)

- Updated `.htaccess` rewrite rules to fix Windows-specific bugs
- Planning to implement query filtering before loading modules

## Build 233 (2024-12-18)

- Added support for data folder mapping through configuration in `dist.php` — rewrite rule redirects one distributor data folder to another

## Build 234 (2024-12-19)

- Added `Database::createViewTable` for creating view tables — provides caching to improve performance with multiple sub-queries
- Added `Database::isTableExists` to check if a table exists
- Enhanced Statement plugin `Max` — replaced simple left join with dual sub-query select statements for more flexible data filtering
- Statement plugin `Max` now supports column names prefixed with `@` as expression syntax

## Build 236 (2024-12-19)

- Fixed Flow plugin `Unique` not working with FlowManager toggle column

## Build 237 (2024-12-27)

- Fixed Entity parsing parameter string as value incorrectly
- Standard regular expression route now captures remaining path as extra parameters

## Build 238 (2024-12-27)

- Fixed KeyValuePair grouping
