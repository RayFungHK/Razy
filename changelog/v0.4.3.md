# Razy v0.4.3

**Builds 213–218** | November 2023 – February 2024

PHP 8.2+ upgrade, template plugin system overhaul, `Action`/`Validation` workflow classes, and extensive database enhancements.

---

## Build 213 (2023-11-29)

- Updated command help
- Fixed rewrite not working on webassets

## Build 214 (2023-12-06)

### Breaking Changes

- Upgraded code base to support **PHP 8.2+**
- Template plugins restructured into 3 classes: `TFunction`, `TFunctionCustom`, and `TModifier` — all plugins must now return an anonymous class extending these
- Removed `Container` class
- Removed `Template\Plugin` class
- Removed `ModuleInfo::commit()` — moved into terminal `commit` command
- Removed `ModuleInfo::unpackAsset()`
- Removed `Distributor::unpackAllAsset()`
- Changed webassets structure

### Additions

- Added `Controller::getModuleInfo()` — pass the `ModuleInfo` object to other modules without security issues, making API registration easier
- Added `Controller::addPluginFolder()` to register `Template` and `Collection` plugin folder locations

### Fixes

- Fixed error handling not working in PHP 8
- Fixed Distributor loading folders without `package.php` wrongly
- Fixed API and Event unable to call internal functions
- Fixed XHR unable to parse null dataset

## Build 215 (2023-12-13)

### Changes

- `Controller::__onAPICall()`, `Controller::__onDispatch()`, `Controller::__onScriptLoaded()`, `Controller::__onTouch()` now pass `ModuleInfo` object instead of string module code
- Added `XHR::onComplete()` event — executes after XHR response is displayed

### Fixes

- Fixed sites configuration preloading attempting to require the distributor config file first (duplicate process with Distributor constructor)
- Fixed event `Emitter` prompting error due to wrong parameter passing
- Fixed `Application::GetDistributorModules()` obtaining incorrect status

## Build 216 (2023-12-19)

- Template Engine now stores the `ModuleInfo` entity when a module loads a template file — accessible directly in plugins
- `Module::execute()`, `Module::accessAPI()`, and `Controller::__onAPICall()` now pass `ModuleInfo` entity instead of string module code

## Build 217 (2024-01-09)

### Additions

- Added `Action`, `Action\Plugin`, and `Action\Validation` classes for handling submit data and validation workflows
  - Built-in plugins: `empty`, `exists`, `password`, `regroup`, `unique` (Beta)
- Added `Statement\Plugin` for preset statements — call methods to generate statements instead of complex syntax
  - Built-in plugin: `max` (Beta)
- `Database\Column` now supports foreign keys

### Fixes

- Fixed `Statement` parsing `NULL` value into empty string instead of `NULL`

## Build 218 (2024-02-14)

### Additions

- `Action` class: added `onQueue`, `onFetch`, and `onDelete` events
- Added `Action::setType()` to change the Action type before submit
- `Action::reject()` now supports alias
- Added `Action::setUniqueKey()` to change the unique key before validation
- Added `Action::setValue()` to change the value of a specified variable
- Added `Controller::__onDispatch()` event for post-processing after script/route finishes
- Added `Controller::getDataPathURL()` to return data path as a URL path
- Added `Database::setTimezone()` to change database timezone offset
- Added `Database::affectedRow` to get affected rows from the latest queue
- Added `Pilot::addShadowRoute()` to bind a shadow route to a specified module's route
- Added `Table::groupIndexing()` to create multi-column indexing
- Added `Validation::postProcess()` event — executes when first validation stage completes
- Added `Validation::bindTo()` to rename variable names in the parameters list
- Added `Validation::ignore()` to ignore adding values into the parameter list

### Changes

- `Application` now builds the `data` folder rewrite rule
- MySQL and PHP can now sync timezone
- `Column`'s `oncurrent` renamed to `oncreate`; added `onupdate` option (both for timestamp/datetime/date value updates on create/update)
- `Statement` plugin `max` added `onBuild` event to modify sub-query statement
- `Statement::from()` and `Statement::where()` now support Closure to modify current value
- `XHR` now can be initialized by `true` to return the result as an array
- `Action` plugin `regroup` now supports key-value pair regrouping
