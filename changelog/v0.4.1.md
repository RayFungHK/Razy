# Razy v0.4.1

**Builds 206–211** | September 2022 – April 2023

Major refactoring of the module system, new `Mailer` class, WebSocket server support, and significant API/routing improvements.

---

## Build 206 (2022-09-29)

### Breaking Changes

- Controller changed to an anonymous class for better shared/distribution module support
- Module code format changed to `vendor/package`
- `Controller::api` now returns an API Emitter instead of passing arguments and command directly
- Removed `Module::getRoutedPath()` — replaced by `Module::getRoutedInfo()` for richer routing information
- Removed `Module::landing()` and `Pilot::conflict()` (less practical than expected)
- Removed `Distributor::redirect()` — replaced by other similar methods
- Renamed `Module::getURLPath()` → `Module::getBaseURL()` (also fixed incorrect path for deeper-folder modules or aliased modules)
- Renamed `Module::getRootURL()` → `Module::getSiteURL()`
- Renamed `Controller::getRootURL()` → `Controller::getBaseURL()`

### Additions

- Added `DOM::__toString()` — entity triggers the toString method
- Added new `Mailer` class for sending email via SMTP (TLS, TLSv1.1, TLSv1.2, SSL, SSLv2, SSLv3, SSLv23 supported)

### Fixes

- Fixed console command `unpackAsset` unpacking the asset under `module code` instead of `alias`
- Fixed `Module::getAssetPath()` returning wrong URL when alias is provided
- Fixed `Controller::goto()` redirecting to wrong URL when alias is provided

## Build 207 (2022-09-30)

- Fixed `.htaccess` rewrite rule not updating after `console.set` command due to cached file buffer
- `console.link`, `console.unlink`, and `console.remove` now update the `.htaccess` rewrite rule
- Moved `terminal.func.php` functions into `Application`

## Build 208 (2022-10-20)

### Additions

- Parameter tag recursion expression now supports passing strings, e.g. `{$emptyval|"Hello World"}`
- Added `urefactor` function — like `refactor` but with a user-defined processor function
- Added new template modifier `alphabet`
- Added `Controller::getDataPath()` to get the module's data folder path

### Changes

- Changed `SimpleSyntax::ExtractExpr()` into an anonymous function

### Fixes

- Table Join Syntax now supports table names enclosed by backtick
- Fixed parenthesis extracting wrong join syntax (condition syntax not parsed)
- Fixed source of table incorrect in join syntax when alias not provided
- Condition in Table Join Syntax now supports specifying source, e.g. `a.table>b.table[column_a]-c.table[b:column_b]`
- `WhereSyntax` now supports assigning `Statement` as parameter value

## Build 209 (2022-12-12)

### Additions

- Added `Controller::__onScriptLoaded()` — triggers before a CLI script executes (same stage as `__onDispatch()`)
- Added `Controller::__onScriptCall()` — triggers when CLI script is ready to execute (same stage as `__onRoute()`)
- Added `Controller::getRequestPath()` to get the distributor request path with domain and port
- Added `Pilot::addScript()` to register a CLI script
- Added `WebSocket::Server` for hosting WebSocket servers
- Added `Terminal::WriteLine()` static method

### Changes

- `Application` class no longer allows query in CLI mode
- `Terminal::writeLine()` renamed to `Terminal::writeLineLogging()`
- `Controller::__onReady()` now triggers in both CLI and Web mode (previously Web only)
- `Distributor::matchRoute()` now also available in CLI mode with same routing logic
- `Terminal::format()` changed to a static method

### Fixes

- Throwing an `Error` now displays correct format in CLI mode

## Build 210 (2023-03-09)

### Additions

- Added `Controller::fork()` to access deeper internal functions (e.g. calling `abc/func` from enclosure files under `abc` folder)
- Added `await` logic in Distributor — execute functions after all specified modules are loaded in ready stage (eliminates handshaking between modules)
- Added `getFutureWeekday` common function to find future weekdays

### Changes

- `Distributor::sessionStart` now triggers before `__onReady` stage
- Moved `Razy\API\Emitter` to `Razy\Emitter` for potential advanced usage

### Fixes

- Fixed Module's API request not triggering `__onAPICall`
- Fixed `Collection\Processor` int and float not returning correct format for non-scalar values
- `SimpleSyntax::ParseSyntax` now can pass a parser to handle every clipped content
- Fixed `Database\TableJoinSyntax` using syntax not working
- Added preset syntax in `Database\TableJoinSyntax` for future expansion
- Fixed `Database\WhereSyntax` SET comparison generating incorrect statement

## Build 211 (2023-04-11)

### Additions

- Added `Module` setting `shadow_asset` — binds asset path to module asset folder instead of shared view folder (not supported for phar modules)
- Added `Database::Column` comment setting
- Controller, Module, and Distributor can now obtain module data folder path with a given module code
- Added `getRelativePath` global function

### Changes

- `Application::UpdateRewriteRules()` now outputs module asset path mappings accurately
- `unpackasset` command now updates the rewrite rules

### Fixes

- Fixed `SimpleSyntax::ParseSyntax()` not skipping bracket symbols properly
- Fixed `Statement::lazyKeyValuePair()` not working with parser
- Fixed `WhereSyntax` converting incorrect function syntax in LIKE operator
